(window.webpackJsonpws_react_chat=window.webpackJsonpws_react_chat||[]).push([[0],{14:function(e,n,t){e.exports={header:"header_header__2pPcS",indicator:"header_indicator__764MB",nickinput:"header_nickinput__2t0np"}},23:function(e,n,t){e.exports={msgarea:"message_msgarea__T3Jdi",timestamp:"message_timestamp__1p8xH"}},24:function(e,n,t){e.exports={inputwrap:"msginput_inputwrap__2CQzL",mesinput:"msginput_mesinput__1VDTs"}},36:function(e,n,t){e.exports={chat:"chat_chat__2ietF"}},40:function(e,n,t){e.exports=t(85)},50:function(e,n,t){},85:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),c=t(12),i=t.n(c),o=t(1),s=t(6),u=t(4);function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(t,!0).forEach((function(n){Object(u.a)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var l={internet:{isOnline:!0},ws:{isOpened:!1}},p=t(13);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(t,!0).forEach((function(n){Object(u.a)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var d={messages:[],messagesPreparedForSending:[]};function E(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?E(t,!0).forEach((function(n){Object(u.a)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var v={settings:{nickname:""}},w=Object(s.b)({connection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"INTERNET_ONLINE":return m({},e,{internet:m({},e.internet,{isOnline:!0})});case"INTERNET_OFFLINE":return m({},e,{internet:m({},e.internet,{isOnline:!1})});case"WS_OPENED":return m({},e,{ws:m({},e.ws,{isOpened:!0})});case"WS_CLOSED":return m({},e,{ws:m({},e.ws,{isOpened:!1})});default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"MESSAGE_RECEIVED":var t=n.payload.messages.filter((function(n){return-1===e.messages.findIndex((function(e){return e.id===n.id}))})),r=e.messages.concat(t).sort((function(e,n){return e<n?-1:e>n?1:0}));return O({},e,{messages:r});case"PREPARE_MESSAGE_FOR_SENDING":return O({},e,{messagesPreparedForSending:[].concat(Object(p.a)(e.messagesPreparedForSending),[n.payload])});case"MESSAGE_SENT":return O({},e,{messagesPreparedForSending:e.messagesPreparedForSending.slice(1)});default:return e}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"NICKNAME_CHANGED":return b({},e,{settings:b({},e.settings,{nickname:n.payload.nickname})});default:return e}}}),y=(t(50),0),j=function(e){return{type:"NICKNAME_CHANGED",payload:{nickname:e}}},h=t(7),S=t(8),_=t(9),N=t(14),k=t.n(N);function P(){var e=Object(S.a)(["\n  ::before {\n    background-color: ",";\n  }\n"]);return P=function(){return e},e}var D=_.a.span(P(),(function(e){return e.online?"greenyellow":"darkred"})),I=Object(o.b)((function(e){return{nickname:e.settings.settings.nickname,websocketIsOpened:e.connection.ws.isOpened}}),{changeNickname:j})((function(e){var n=e.nickname,t=e.websocketIsOpened,r=e.changeNickname;return a.a.createElement("div",{className:k.a.header},a.a.createElement("span",null,a.a.createElement("label",{htmlFor:"nickinput"},"Write your nickname here:"),a.a.createElement("input",{type:"text",className:k.a.nickinput,value:n,id:"nickinput",onChange:function(e){return r(e.target.value)},required:!0})),a.a.createElement(D,{className:k.a.indicator,online:t},t?"ServerKeepsRunning":"Offline???..."))})),T=t(35),F=t.n(T),L=t(23),M=t.n(L);function R(){var e=Object(S.a)(["\n  color: ",";\n"]);return R=function(){return e},e}var A=_.a.span(R(),(function(e){return e.currentUserNickname===e.sender?"rgb(167, 115, 219)":"rgb(185, 123, 94)"})),C=Object(o.b)((function(e){return{nickname:e.settings.settings.nickname}}))((function(e){var n=e.time,t=e.message,r=e.from,c=e.nickname;return a.a.createElement("div",{className:M.a.msgarea},a.a.createElement("span",{className:M.a.timestamp},"[".concat(n.toLocaleString(h.DateTime.DATETIME_SHORT),"]")),a.a.createElement(A,{currentUserNickname:c,sender:r},"".concat(r,":")),a.a.createElement("span",null,t))}));function x(){var e=Object(S.a)(["\n  padding-left: 10px;\n  overflow-wrap: break-word;\n  overflow-y: auto;\n  border-top: 1px solid #cccccc;\n  }\n"]);return x=function(){return e},e}var G=Object(_.a)(F.a).attrs((function(){return{}}))(x()),W=Object(o.b)((function(e){return{messages:e.messages.messages,messagesPreparedForSending:e.messages.messagesPreparedForSending,nickname:e.settings.settings.nickname}}))((function(e){var n=e.messages,t=e.messagesPreparedForSending,r=e.nickname;return a.a.createElement(G,null,n.map((function(e){var n=e.id,t=e.time,r=e.message,c=e.from;return a.a.createElement(C,{key:n,time:t,message:r,from:c})})),t.map((function(e){var n=e.id,t=e.message;return a.a.createElement(C,{key:n,time:h.DateTime.fromMillis(Date.now()),message:t,from:r,notSent:!0})})))})),J=t(37),V=t(24),H=t.n(V),K=Object(o.b)((function(e){return{nickname:e.settings.settings.nickname}}),{prepareMessageForSending:function(e){var n=y;return y++,{type:"PREPARE_MESSAGE_FOR_SENDING",payload:{message:e,id:n}}}})((function(e){e.nickname;var n=e.prepareMessageForSending,t=Object(r.useState)(""),c=Object(J.a)(t,2),i=c[0],o=c[1],s=function(){i.trim()&&(n(i),o(""))};return a.a.createElement("div",{className:H.a.inputwrap},a.a.createElement("input",{className:H.a.mesinput,placeholder:"Write your message here(after filling a nickname)",autoFocus:!0,value:i,onChange:function(e){return o(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&s()}}),a.a.createElement("button",{onClick:s},"send"))})),U=t(36),X=t.n(U),B=function(){return a.a.createElement("div",{className:X.a.chat},a.a.createElement(I,null),a.a.createElement(W,null),a.a.createElement(K,null))},q=function(e,n){Object.keys(n).forEach((function(t){n[t]&&e.addEventListener(t,n[t])}))},Y=function(e,n){Object.keys(n).forEach((function(t){n[t]&&e.removeEventListener(t,n[t])}))};function z(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var Q=Object(o.b)((function(e){return{nickname:e.settings.settings.nickname,websocketIsOpened:e.connection.ws.isOpened,messagesPreparedForSending:e.messages.messagesPreparedForSending}}),{receiveMessage:function(e){return{type:"MESSAGE_RECEIVED",payload:{messages:e}}},messageSent:function(){return{type:"MESSAGE_SENT"}},changeNickname:j})((function(e){var n=e.wsserver,t=e.nickname,c=e.changeNickname,i=e.websocketIsOpened,s=e.receiveMessage,f=e.messagesPreparedForSending,m=e.messageSent,l=Object(r.useMemo)((function(){return{onMessage:function(e){var n,t=JSON.parse(e.data).reverse().map((function(e){return function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?z(t,!0).forEach((function(n){Object(u.a)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):z(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},e,{time:h.DateTime.fromMillis(e.time)})}));s(t),n=t,"undefined"!==typeof Notification&&"visible"!==document.visibilityState&&n.length&&Notification.requestPermission().then((function(e){if("granted"===e){var t,r;if(n.length>1){var a=Object(p.a)(new Set(n.map((function(e){return e.from}))));t="You've got ".concat(n.length," new messages"),r="From ".concat(a.slice(0,3).join(", ")).concat(a.length>3?" and others.":".")}else t="You've got a message from ".concat(n[0].from),r="".concat(n[0].message);var c=new Notification(t,{body:r});setTimeout(c.close.bind(c),4e3)}}))}}}),[s]),g=function(e){var n=e.isOnline,t=e.wsserver,a=e.restartInMs,c=void 0===a?2e3:a,i=e.callbacks,s=void 0===i?{}:i,u=Object(r.useRef)(null),f=Object(o.c)();return Object(r.useEffect)((function(){var e=function(){u.current&&u.current.close(),f({type:"WS_CLOSED"})},r=function(){u.current=new WebSocket(t)},a=function(){Y(u.current,p),e(),r(),q(u.current,p)},i=s.onOpen,o=s.onClose,m=s.onMessage,l=s.onError,p={open:function(e){f({type:"WS_OPENED"}),i&&i(e)},close:function(e){o&&o(e),1e3!==e.code&&setTimeout(a,c)},message:m,error:function(e){l&&l(e),setTimeout(a,c)}};return n?(r(),q(u.current,p)):setTimeout(a,c),function(){e(),Y(u.current,p)}}),[t,s,f,n,c]),u.current}({isOnline:function(){var e=Object(o.c)(),n=Object(o.d)((function(e){return e.connection.internet.isOnline}));return Object(r.useEffect)((function(){var n=function(){e({type:"INTERNET_ONLINE"})},t=function(){e({type:"INTERNET_OFFLINE"})};return window.addEventListener("online",n),window.addEventListener("offline",t),function(){window.removeEventListener("online",n),window.removeEventListener("offline",t)}}),[e]),Object(r.useEffect)((function(){window.navigator.onLine&&!n?e({type:"INTERNET_ONLINE"}):!window.navigator.onLine&&n&&e({type:"INTERNET_OFFLINE"})}),[e,n]),{isOnline:n}}().isOnline,wsserver:n,callbacks:l});return Object(r.useEffect)((function(){var e=localStorage.getItem("nickname");e&&c(JSON.parse(e))}),[c]),Object(r.useEffect)((function(){localStorage.setItem("nickname",JSON.stringify(t))}),[t]),Object(r.useEffect)((function(){i&&f.length&&(g.send(JSON.stringify({from:t,message:f[0].message})),m())}),[g,t,m,i,f]),a.a.createElement(B,null)}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var $=Object(s.c)(w,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());i.a.render(a.a.createElement(o.a,{store:$},a.a.createElement(Q,{wsserver:"wss://wssproxy.herokuapp.com/"})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[40,1,2]]]);
//# sourceMappingURL=main.fce38ec7.chunk.js.map